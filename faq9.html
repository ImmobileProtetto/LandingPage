<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="FAQ — Immobile Protetto" />
  <meta name="theme-color" content="#0b1f3a" />
  <title>FAQ — Immobile Protetto</title>

  <link rel="stylesheet" href="faq9.css" />
</head>

<body>
  <main class="page" role="main">
    <section class="faq" aria-label="Domande frequenti">
      <div class="faq__shell">

        <!-- rail sinistra (desktop: sticky) -->
        <aside class="rail" aria-label="FAQ">
          <div class="rail__inner">
            <h2 class="rail__title">FAQ</h2>

            <!-- sempre logo LIGHT (colorato) -->
            <div class="rail__logo" aria-label="Immobile Protetto">
              <img class="rail__img" src="logo/mark_light.png" alt="Immobile Protetto" loading="eager" decoding="async" />
            </div>
          </div>
        </aside>

        <!-- contenuto destra -->
        <div class="stack" id="faqStack">
          <!-- FAQ principali -->
          <details class="item" open id="faq-1">
            <summary class="q">
              <p class="question justify">La registrazione e il sopralluogo sono davvero gratuiti?</p>
              <span class="q__icon" aria-hidden="true"></span>
            </summary>
            <div class="a"><div class="a__inner">
              <p class="muted justify">
                Sì. La registrazione e (se l'immobile è compatibile) il sopralluogo servono alla valutazione iniziale e non hanno costi.
                Prima di qualsiasi passo successivo ti spieghiamo le condizioni in modo chiaro nella proposta.
              </p>
            </div></div>
          </details>

          <details class="item" id="faq-2">
            <summary class="q">
              <p class="question justify">Registrare l’immobile mi vincola in qualche modo?</p>
              <span class="q__icon" aria-hidden="true"></span>
            </summary>
            <div class="a"><div class="a__inner">
              <p class="muted justify">
                No. La registrazione serve a capire rapidamente se ha senso procedere con il sopralluogo. Puoi fermarti in qualsiasi momento.
                Usiamo i dati solo per ricontatto e valutazione, come indicato nell’informativa privacy.
              </p>
            </div></div>
          </details>

          <details class="item" id="faq-3">
            <summary class="q">
              <p class="question justify">In che città siete operativi?</p>
              <span class="q__icon" aria-hidden="true"></span>
            </summary>
            <div class="a"><div class="a__inner">
              <p class="muted justify">
                In questa fase lavoriamo nelle province di Pescara e Chieti. Stiamo estendendo il servizio in altre città:
                se sei fuori zona, puoi registrare lo stesso e ti ricontattiamo quando attiviamo la tua area.
              </p>
            </div></div>
          </details>

          <details class="item" id="faq-4">
            <summary class="q">
              <p class="question justify">Che tipo di immobili accettate?</p>
              <span class="q__icon" aria-hidden="true"></span>
            </summary>
            <div class="a"><div class="a__inner">
              <p class="muted justify">
                Appartamenti e case ad uso abitativo in buono stato. Valutiamo caso per caso: se è idoneo o servono piccoli interventi
                te lo diciamo chiaramente e te li indichiamo, poi decidi tu.
              </p>
            </div></div>
          </details>

          <details class="item" id="faq-5">
            <summary class="q">
              <p class="question justify">Chi sono gli inquilini e come li selezionate?</p>
              <span class="q__icon" aria-hidden="true"></span>
            </summary>
            <div class="a"><div class="a__inner">
              <p class="muted justify">
                Gli inquilini sono dipendenti pubblici: verifichiamo identità, contratto di lavoro, reddito e nucleo familiare.
                Il profilo finale viene scelto tenendo conto delle preferenze indicate in fase di registrazione.
              </p>
            </div></div>
          </details>

          <details class="item" id="faq-6">
            <summary class="q">
              <p class="question justify">Quanto tempo ci mettete a ricontattarmi?</p>
              <span class="q__icon" aria-hidden="true"></span>
            </summary>
            <div class="a"><div class="a__inner">
              <p class="muted justify">
                Entro 1–2 giorni lavorativi ti rispondiamo via e-mail con esito (idoneo/non idoneo). Se idoneo, ti proponiamo
                le prime disponibilità per il sopralluogo.
              </p>
            </div></div>
          </details>

          <!-- progressive disclosure: FAQ secondarie -->
          <div class="more">
            <button class="more__btn" type="button" id="moreBtn"
                    aria-expanded="false" aria-controls="morePanel">
              <span class="q__text">Leggi altre FAQ</span>
              <span class="q__icon" aria-hidden="true"></span>
            </button>

            <div class="more__panel" id="morePanel" hidden>
              <div class="more__inner">
                <details class="item item--sub" id="faq-7">
                  <summary class="q">
                    <p class="question justify">Danni e manutenzione: chi gestisce cosa?</p>
                    <span class="q__icon" aria-hidden="true"></span>
                  </summary>
                  <div class="a"><div class="a__inner">
                    <p class="muted justify">
                      Prima di partire definiamo tutto per iscritto: inventario iniziale, regole, ruoli e responsabilità.
                      Per guasti/manutenzioni ti avvisiamo e concordiamo tempi e modalità (e, se previsto, come intervengono tutela/assicurazione indicate in proposta).
                    </p>
                  </div></div>
                </details>

                <details class="item item--sub" id="faq-8">
                  <summary class="q">
                    <p class="question justify">Se voglio rientrare, vendere o interrompere, come funziona?</p>
                    <span class="q__icon" aria-hidden="true"></span>
                  </summary>
                  <div class="a"><div class="a__inner">
                    <p class="muted justify">
                      Nella proposta operativa indichiamo in modo chiaro durata, preavviso e condizioni di uscita.
                      Se vuoi rientrare o vendere, gestiamo la transizione con passaggi e tempi definiti per evitare blocchi e imprevisti.
                    </p>
                  </div></div>
                </details>

                <details class="item item--sub" id="faq-9">
                  <summary class="q">
                    <p class="question justify">Privacy: come trattate i miei dati?</p>
                    <span class="q__icon" aria-hidden="true"></span>
                  </summary>
                  <div class="a"><div class="a__inner">
                    <p class="muted justify">
                      Usiamo i dati inseriti per ricontatto e valutazione dell’immobile e li trattiamo secondo l’informativa privacy.
                      Non li utilizziamo per finalità diverse senza consenso; puoi chiedere accesso, modifica o cancellazione secondo le modalità indicate nell’informativa.
                    </p>
                  </div></div>
                </details>
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>

  <!-- Sezione di test: spazio vuoto per verificare sticky/swap oltre le FAQ -->
  <section class="after" id="afterSpacer" aria-hidden="true"></section>

  </main>

  <script>
    (() => {
      const root = document.documentElement;
      const faq = document.querySelector('.faq');
      const stack = document.getElementById('faqStack');
      if (!stack || !faq) return;

      const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const OPEN_MS  = reduce ? 1 : 180;
      const CLOSE_MS = reduce ? 1 : 150;

      const moreBtn = document.getElementById('moreBtn');
      const morePanel = document.getElementById('morePanel');
      const spacer = document.getElementById('afterSpacer');

      const isMobile = () => window.matchMedia('(max-width: 979px)').matches;
      const stickyTop = () => {
        const v = getComputedStyle(root).getPropertyValue('--stickyTop').trim();
        const n = parseFloat(v);
        return Number.isFinite(n) ? n : 12;
      };

      const updateSpacer = () => {
        if (!spacer) return;
        // Altezza: 2x dell'attuale estensione della sezione FAQ (minimo di sicurezza)
        const h = Math.round(faq.offsetHeight || 0);
        spacer.style.height = Math.max(900, h * 2) + 'px';
      };

      const updateSwap = () => {
        if (!moreBtn) return;
        const expanded = moreBtn.getAttribute('aria-expanded') === 'true';
        if (!expanded || !isMobile()) {
          faq.classList.remove('is-swapped');
          return;
        }
        const top = stickyTop();
        const rect = moreBtn.getBoundingClientRect();
        if (rect.top <= top + 1) faq.classList.add('is-swapped');
        else faq.classList.remove('is-swapped');
      };

      const getA = (d) => d.querySelector('.a');

      const closeDetail = (d) => {
        if (!d.open) return;

        const a = getA(d);
        if (!a) { d.open = false; updateSpacer(); updateSwap(); return; }

        const h = a.getBoundingClientRect().height;
        a.style.height = h + 'px';
        a.style.opacity = '1';
        a.style.overflow = 'hidden';

        const anim = a.animate(
          [{ height: h + 'px', opacity: 1 }, { height: '0px', opacity: 0 }],
          { duration: CLOSE_MS, easing: 'cubic-bezier(.4,0,.2,1)' }
        );

        anim.onfinish = () => {
          d.open = false;
          a.style.height = '';
          a.style.opacity = '';
          a.style.overflow = '';
          updateSpacer();
          updateSwap();
        };
      };

      const openDetail = (d) => {
        if (d.open) return;

        // accordion single-open
        stack.querySelectorAll('details.item[open]').forEach((other) => {
          if (other !== d) closeDetail(other);
        });

        d.open = true;

        const a = getA(d);
        if (!a) { updateSpacer(); updateSwap(); return; }

        a.style.height = '0px';
        a.style.opacity = '0';
        a.style.overflow = 'hidden';

        const targetH = a.scrollHeight;

        const anim = a.animate(
          [{ height: '0px', opacity: 0 }, { height: targetH + 'px', opacity: 1 }],
          { duration: OPEN_MS, easing: 'cubic-bezier(.2,.8,.2,1)' }
        );

        anim.onfinish = () => {
          a.style.height = 'auto';
          a.style.opacity = '1';
          a.style.overflow = '';
          updateSpacer();
          updateSwap();
        };
      };

      // click su summary: anima apertura/chiusura (niente scatto)
      stack.addEventListener('click', (e) => {
        const summary = e.target.closest('summary.q');
        if (!summary) return;

        const d = summary.parentElement;
        if (!(d instanceof HTMLDetailsElement) || !d.classList.contains('item')) return;

        e.preventDefault();
        if (d.open) closeDetail(d);
        else openDetail(d);
      });

      // Progressive disclosure (Leggi altre FAQ)
      const setMore = (open) => {
        if (!moreBtn || !morePanel) return;

        moreBtn.setAttribute('aria-expanded', String(open));

        if (open) {
          morePanel.hidden = false;
          requestAnimationFrame(() => morePanel.classList.add('is-open'));
        } else {
          morePanel.classList.remove('is-open');
          morePanel.querySelectorAll('details[open]').forEach(d => { d.open = false; });
          setTimeout(() => { morePanel.hidden = true; }, 200);
          faq.classList.remove('is-swapped');
        }

        updateSpacer();
        updateSwap();
      };

      if (moreBtn && morePanel) {
        moreBtn.addEventListener('click', () => {
          const open = moreBtn.getAttribute('aria-expanded') === 'true';
          setMore(!open);
        });
      }

      // scroll/resize: swap topbar su mobile
      window.addEventListener('scroll', updateSwap, { passive: true });
      window.addEventListener('resize', () => { updateSpacer(); updateSwap(); });

      // init
      updateSpacer();
      updateSwap();
    })();
  </script>
</body>
</html>
